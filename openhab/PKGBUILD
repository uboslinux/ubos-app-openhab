developer='http://www.openhab.org/'
url=${developer}
maintainer=http://indiecomputing.com/
pkgname=$(basename $(pwd))
pkgver=2.2.0
pkgrel=1
_snap=
pkgdesc="Home automation software"
arch=('any')
license=('EPL')
depends=('java-runtime-headless=8')
install=openhab.install

backup=('etc/openhab/services/addons.cfg'
		'etc/openhab/services/runtime.cfg')
# install="openhab.install"

source=(
    "openhab-${pkgver}.tar.gz::https://bintray.com/openhab/mvn/download_file?file_path=org%2Fopenhab%2Fdistro%2Fopenhab%2F${pkgver}%2Fopenhab-${pkgver}${_snap}.tar.gz")
sha512sums=('3ea8110d4c6289732860c611b78b1955d6024d19bcf168d53d00a82e8cd8dc43936a5a9dc5c35840c436fa40085f9b1ce98654b0edaa04169ae39c86a606fccd')

prepare() {
	patch -p1 < ../openhab.patch
}

package() {
# Manifest
    install -D -m0644 ${startdir}/ubos-manifest.json ${pkgdir}/ubos/lib/ubos/manifests/${pkgname}.json

# Icons
#    install -D -m0644 ${startdir}/appicons/{72x72,144x144}.png -t ${pkgdir}/ubos/http/_appicons/$pkgname/

# Defaults - same for all appconfigs
    install -D -m0644 ${startdir}/openhab.default ${pkgdir}/etc/default/openhab

# Systemd
    install -D -m644 ${startdir}/systemd/*.service -t ${pkgdir}/usr/lib/systemd/system/

    mkdir -p ${pkgdir}/etc/openhab

    mkdir -p ${pkgdir}/ubos/lib/openhab
    mkdir -p ${pkgdir}/var/log/openhab

    mkdir -p ${pkgdir}/ubos/share/openhab
    cp -a ${srcdir}/{LICENSE.TXT,runtime} ${pkgdir}/ubos/share/openhab/

	mkdir -p ${pkgdir}/var/log/openhab

    install -Dm644 ${startdir}/systemd/openhab.sysusers.conf ${pkgdir}/usr/lib/sysusers.d/openhab.conf
}
